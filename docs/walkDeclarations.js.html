<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: walkDeclarations.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: walkDeclarations.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module */

import matches from "./matches.js";

/**
 * Recursively walk all declarations
 * @param {Object|Array} rules - AST, array of rules, or single rule
 * @param {Function} callback - Callback to be executed on each declaration. Arguments: (declaration, rule)
 * @param {Object} [test] - Conditions that need to be satisfied for a declaration to be visited, all optional
 * @param {string|RegExp|Function|Array} test.properties - Test for property names
 * @param {string|RegExp|Function|Array} test.values - Test for values
 * @param {string|RegExp|Function|Array} test.rules - Test for rules
 */
export default function walkDeclarations(rules, callback, test) {
	if (!rules) {
		return;
	}

	if (rules.stylesheet) {
		// AST passed
		rules = rules.stylesheet.rules;
	}
	else if (!Array.isArray(rules)) {
		// Single rule
		rules = [rules];
	}

	for (let rule of rules) {
		if (!matches(rule, test &amp;&amp; test.rules) || matches(rule, test &amp;&amp; test.not &amp;&amp; test.not.rules, true)) {
			continue;
		}

		// Walk declarations directly in rule
		if (rule.declarations) {
			for (let declaration of rule.declarations) {
				if (declaration.type !== "declaration") {
					continue;
				}

				let {property, value} = declaration;
				let important = false;

				value = value.replace(/\s*!important\s*$/, $0 => {
					important = true;
					return "";
				});

				if (!test ||
				        matches(property, test.properties)
				    &amp;&amp;  matches(value, test.values)
				    &amp;&amp; !matches(property, test.not &amp;&amp; test.not.properties, true)
				    &amp;&amp; !matches(value, test.not &amp;&amp; test.not.values, true)
				) {
					callback({property, value, important}, rule);
				}
			}
		}

		// Walk declarations of nested rules (e.g. @media, @supports have nested rules)
		if (rule.rules) {
			walkDeclarations(rule.rules, callback, test);
		}
	}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-countDeclarations.html">countDeclarations</a></li><li><a href="module-countDeclarationsByProperty.html">countDeclarationsByProperty</a></li><li><a href="module-extractFunctionCalls.html">extractFunctionCalls</a></li><li><a href="module-incrementByKey.html">incrementByKey</a></li><li><a href="module-matches.html">matches</a></li><li><a href="module-removeFunctionCalls.html">removeFunctionCalls</a></li><li><a href="module-sortObject.html">sortObject</a></li><li><a href="module-sumObject.html">sumObject</a></li><li><a href="module-walkDeclarations.html">walkDeclarations</a></li><li><a href="module-walkRules.html">walkRules</a></li><li><a href="module-walkSelectors.html">walkSelectors</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
